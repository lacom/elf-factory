#!/usr/bin/env node

var program = require('commander');
var fs = require('fs');
var exec = require('child_process').exec;
var open = require('open');
var request = require('request');
var util = require('../lib/utilities.js')
var _exit = process.exit;
// Re-assign process.exit because of commander
// TODO: Switch to a different command framework
process.exit = exit;

var SITE_URL = config.SITE_URL;
var SITE_DOMAIN = config.SITE_DOMAIN;

var interactionName = interaction;
console.log(interactionName);
interactionName = util.slugify(interactionName);

var siteUrl = (env && env == 'development') ? 'http://localhost:3000' : SITE_URL;
var siteDomain = (env && env == 'development') ? 'localhost:3000' : SITE_DOMAIN;

var auth = netrc(siteDomain);


request.get(siteUrl + '/api/v1/i/' + interactionName,  auth: {
       'user': auth.login,
       'pass':  auth.password,
       'sendImmediately': true
      }, 
      function(error, response, body){
      	if(error){
      		console.log("No interaction found! Error");
      		util.exit(1);
      	}
      	if(body == 'Unauthorized') {
      		console.log('Please add your auth credentials to your .netrc file first.');
			util.exit(1);
      	}else if(body == !'success'){
      		console.log(body);
      		util.exit(1);
      	}else{
      		console.log(response.message);
      		open(SITE_URL + '/api/v1/i/' + interactionName);
      	}
	  });